<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crear Proveedor – Súper Único</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{ --bg:#f6f7f2; --card:#fff; --ink:#17261a; --muted:#6b7280;
           --primary:#2e7d32; --ring:#9ad17f; --radius:16px; --shadow:0 10px 28px rgba(20,48,28,.10); }
    *{ box-sizing:border-box }
    body{
      margin:0; font-family:"Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink);
      background:
        radial-gradient(1100px 520px at 15% -10%, #e9f4e5 0%, transparent 60%),
        radial-gradient(900px 460px at 95% 10%, #fff4d8 0%, transparent 55%),
        var(--bg);
      min-height:100vh; display:grid; place-items:center; padding:16px;
    }
    .wrap{ width:min(96vw,720px); display:grid; gap:18px }
    header{ display:flex; justify-content:space-between; align-items:center }
    a.btn-link{ color:var(--primary); text-decoration:none; font-weight:700 }
    .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px }
    .form{ display:grid; gap:14px }
    .row{ display:grid; gap:12px }
    @media (min-width:760px){ .row{ grid-template-columns:1fr 1fr } }
    label{ font-size:12px; color:var(--muted) }
    input[type="text"], input[type="email"]{
      width:100%; padding:12px; border-radius:12px; border:1.5px solid #dfe5df; background:#f9fbf7;
      font-size:16px; outline:none; transition:border .2s, box-shadow .2s;
    }
    input:focus{ border-color:var(--primary); box-shadow:0 0 0 4px var(--ring); background:#fff }
    .switch{ display:flex; align-items:center; gap:10px }
    .switch input{ accent-color:var(--primary) }
    .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:8px; flex-wrap:wrap }
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 16px; cursor:pointer; font-weight:800;
    }
    .btn-primary{ background:linear-gradient(180deg,#2e7d32,#265f2a); color:#fff }
    .btn-secondary{ background:#eef7e9; border:1.5px solid #d7ecd2; color:#1b5e20 }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h2 style="margin:0">Crear proveedor</h2>
      <a class="btn-link" href="/proveedores">← Volver al listado</a>
    </header>

    <section class="card">
      <form class="form" id="formProv">
        <div class="row">
          <div>
            <label for="nit">NIT (máx. 15) *</label>
            <input id="nit" name="nit" type="text" maxlength="15" required />
          </div>
          <div>
            <label for="nombre">Nombre (máx. 50) *</label>
            <input id="nombre" name="nombre" type="text" maxlength="50" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="telefono">Teléfono (máx. 10)</label>
            <input id="telefono" name="telefono" type="text" maxlength="10" />
          </div>
          <div>
            <label for="email">Email (máx. 100)</label>
            <input id="email" name="email" type="email" maxlength="100" />
          </div>
        </div>

        <div>
          <label for="direccion">Dirección (máx. 30)</label>
          <input id="direccion" name="direccion" type="text" maxlength="30" />
        </div>

        <div class="switch">
          <input id="estado" name="estado" type="checkbox" checked />
          <label for="estado">Proveedor activo</label>
        </div>

        <div class="actions">
          <button class="btn btn-secondary" type="button" onclick="location.href='/proveedores'">Cancelar</button>
          <button class="btn btn-primary" type="submit">Guardar</button>
        </div>
      </form>
    </section>
  </main>

  <script>
  // Crear proveedor (si NIT no existe)
  const form = document.getElementById('formProv');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();

    const nit       = document.getElementById('nit').value.trim();
    const nombre    = document.getElementById('nombre').value.trim();
    const telefono  = document.getElementById('telefono').value.trim();
    const direccion = document.getElementById('direccion').value.trim();
    const email     = document.getElementById('email').value.trim();
    const estado    = document.getElementById('estado').checked ? 1 : 0;

    if(!nit || !nombre){
      alert("NIT y Nombre son obligatorios");
      return;
    }

    // Verifica existencia por NIT
    const chk = await fetch(`/api/proveedores/${encodeURIComponent(nit)}`);
    const cj = await chk.json();
    if(cj.ok && cj.found){
      alert("Ya existe un proveedor con ese NIT");
      return;
    }

    const resp = await fetch("/api/proveedores", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ nit, nombre, telefono, direccion, email, estado })
    });
    const data = await resp.json();
    if(data.ok){
      alert("Proveedor creado correctamente");
      window.location.href = "/proveedores";
    }else{
      alert(data.error || "No se pudo crear el proveedor");
    }
  });
  </script>
</body>
</html>
